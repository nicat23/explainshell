# Development commands
serve:
	python runserver.py

test:
	pytest tests/ explainshell/ --doctest-modules --cov=explainshell

lint:
	flake8 explainshell/ tests/
	black --check explainshell/ tests/

format:
	black explainshell/ tests/

# Docker commands
build:
	docker-compose build

up:
	docker-compose up -d

down:
	docker-compose down

logs:
	docker-compose logs -f

restart:
	docker-compose restart

# Production commands
prod-build:
	docker-compose -f docker-compose.prod.yml build

prod-up:
	docker-compose -f docker-compose.prod.yml up -d

prod-down:
	docker-compose -f docker-compose.prod.yml down

prod-logs:
	docker-compose -f docker-compose.prod.yml logs -f

# Database commands
db-dump:
	docker-compose exec db mongodump --archive --gzip --db explainshell

db-restore:
	docker-compose exec -T db mongorestore --archive --gzip --db explainshell

# Cleanup commands
clean:
	docker system prune -f
	pip cache purge

clean-all:
	docker system prune -af
	docker volume prune -f
clean-app:
	find . -type f -name '*.py[co]' -delete -o -type d -name __pycache__ -delete
# Security scan
security-scan:
	docker run --rm -v $(PWD):/app -w /app securecodewarrior/docker-security-scan

.PHONY: serve test lint format build up down logs restart prod-build prod-up prod-down prod-logs db-dump db-restore clean clean-all security-scan
